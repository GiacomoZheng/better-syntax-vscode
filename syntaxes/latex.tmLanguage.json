{
	"$schema": "../tmlanguage.json",

	"name": "latex",

	"scopeName": "text.tex.latex",
	"patterns": [
		{
			"include": "#comments"
		},
		{
			"include": "#headers"
		},
		{
			"Comment": "I'm confused by the original version",
			"begin": "(?:\\s*)((\\\\)begin)(\\{)(document)(\\})",
			"beginCaptures": {
				"0": {
					"name": "meta.function.begin-document.latex"
				},
				"1": {
					"name": "support.function.be.latex"
				},
				"2": {
					"name": "punctuation.definition.function.latex"
				},
				"3": {
					"name": "punctuation.definition.arguments.begin.latex"
				},
				"4": {
					"name": "variable.parameter.function.latex"
				},
				"5": {
					"name": "punctuation.definition.arguments.end.latex"
				}
			},
			"end": "(?:\\s*)((\\\\)end)(\\{)(document)(\\})",
			"captures": {
				"0": {
					"name": "meta.function.begin-document.latex"
				},
				"1": {
					"name": "support.function.be.latex"
				},
				"2": {
					"name": "punctuation.definition.function.latex"
				},
				"3": {
					"name": "punctuation.definition.arguments.begin.latex"
				},
				"4": {
					"name": "variable.parameter.function.latex"
				},
				"5": {
					"name": "punctuation.definition.arguments.end.latex"
				}
			},
			"contentName": "meta.document.latex",
			"Comment-contentName": "undetermined",
			"patterns": [
				{
					"include": "#math-blocks"
				},
				{
					"include": "#main-blocks"
				}
			]
		},

		{
			"include": "#rest-blocks"
		},
		{
			"include": "#rest-functions"
		}
	],

	"repository": {
		"headers": {
			"patterns": [
				{
					"begin": "((\\\\)(?:usepackage|documentclass))((?:\\[[^\\[]*?\\])*)(\\{)",
					"beginCaptures": {
						"1": {
							"name": "keyword.control.preamble.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"patterns": [
								{
									"include": "#optional-arg"
								}
							]
						},
						"4": {
							"name": "punctuation.definition.arguments.begin.latex"
						}
					},
					"contentName": "support.class.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"name": "meta.preamble.latex",
					"patterns": [
						{
							"include": "$self"
						}
					]
				},
				{
					"begin": "((\\\\)(?:include|input))(\\{)",
					"beginCaptures": {
						"1": {
							"name": "keyword.control.include.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						}
					},
					"contentName": "support.class.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"name": "meta.include.latex",
					"patterns": [
						{
							"include": "$self"
						}
					]
				},
				{
					"captures": {
						"1": {
							"name": "storage.type.function.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.begin.latex"
						},
						"4": {
							"name": "support.function.general.latex"
						},
						"5": {
							"name": "punctuation.definition.function.latex"
						},
						"6": {
							"name": "punctuation.definition.end.latex"
						}
					},
					"match": "((\\\\)(?:newcommand|renewcommand|(?:re)?newrobustcmd|DeclareRobustCommand))\\*?({)((\\\\)[^}]*)(})"
				}
			]
		},

		"math-blocks": {
			"patterns": [
				{
					"begin": "(\\\\\\[)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.string.begin.latex"
						}
					},
					"end": "(\\\\\\])",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.string.end.latex"
						}
					},
					"name": "support.class.math.block.latex",
					"patterns": [
						{
							"include": "#math-formulas"
						},
						{
							"include": "#main-blocks"
						}
					]
				},
				{
					"begin": "(\\\\\\()",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.string.begin.latex"
						}
					},
					"end": "(\\\\\\))",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.string.end.latex"
						}
					},
					"name": "support.class.math.block.latex",
					"patterns": [
						{
							"include": "#math-formulas"
						},
						{
							"include": "#main-blocks"
						}
					]
				},
				{
					"begin": "(\\$\\$|\\$)",
					"beginCaptures": {
						"1": {
							"name": "punctuation.definition.string.begin.latex"
						}
					},
					"end": "(\\1)",
					"endCaptures": {
						"1": {
							"name": "punctuation.definition.string.end.latex"
						}
					},
					"name": "support.class.math.block.latex",
					"patterns": [
						{
							"match": "\\\\\\$",
							"name": "constant.character.escape.latex"
						},
						{
							"include": "#math-formulas"
						},
						{
							"include": "#main-blocks"
						}
					]
				},

				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)((?:equation)(?:\\*)?)(\\})(\\s*\\n)?",
					"captures": {
						"1": {
							"name": "support.function.be.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						},
						"4": {
							"name": "variable.parameter.function.latex"
						},
						"5": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"contentName": "support.class.math.block.environment.latex",
					"end": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.math.$4.latex",
					"patterns": [
						{
							"match": "(?<!\\\\)&",
							"name": "invalid.illegal.equation.align.latex",
							"Cname": "keyword.control.equation.align.latex"
						},
						{
							"include": "#definition-label"
						},
						{
							"include": "#math-formulas"
						},
						{
							"include": "#main-blocks"
						}
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)((?:multline|gather|displaymath)(?:\\*)?)(\\})(\\s*\\n)?",
					"captures": {
						"1": {
							"name": "support.function.be.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						},
						"4": {
							"name": "variable.parameter.function.latex"
						},
						"5": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"contentName": "support.class.math.block.environment.latex",
					"end": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.math.$4.latex",
					"patterns": [
						{
							"match": "(?<!\\\\)&",
							"name": "invalid.illegal.equation.align.latex",
							"Cname": "keyword.control.equation.align.latex"
						},
						{
							"include": "#definition-label"
						},
						{
							"include": "#math-formulas"
						},
						{
							"include": "#main-blocks"
						}
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)((?:align|alignat|(?:IEEE)?eqnarray|split)(?:\\*)?)(\\})(\\s*\\n)?",
					"captures": {
						"1": {
							"name": "support.function.be.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						},
						"4": {
							"name": "variable.parameter.function.latex"
						},
						"5": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"contentName": "support.class.math.block.environment.latex",
					"end": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.math.$4.latex",
					"patterns": [
						{
							"match": "(?<!\\\\)&",
							"name": "keyword.control.equation.align.latex"
						},
						{
							"include": "#definition-label"
						},
						{
							"include": "#math-formulas"
						},
						{
							"include": "#main-blocks"
						}
					]
				}
			],
			"repository": {
				"math-formulas": {
					"patterns": [
						{
							"Comment": "braces",
							"begin": "(?<!\\\\)\\{",
							"beginCaptures": {
								"0": {
									"name": "punctuation.group.begin.tex"
								}
							},
							"end": "(?<!\\\\)\\}",
							"endCaptures": {
								"0": {
									"name": "punctuation.group.end.tex"
								}
							},
							"name": "meta.group.braces.math.latex",
							"patterns": [
								{
									"include": "#math-formulas"
								},
								{
									"include": "#main-blocks"
								}
							]
						},

						{
							"Comment": "matrix",
							"begin": "(?:\\s*)((\\\\)begin)(\\{)([a-zA-Z]*matrix)(\\})",
							"captures": {
								"1": {
									"name": "support.function.be.latex"
								},
								"2": {
									"name": "punctuation.definition.function.latex"
								},
								"3": {
									"name": "punctuation.definition.arguments.begin.latex"
								},
								"4": {
									"name": "variable.parameter.function.latex"
								},
								"5": {
									"name": "punctuation.definition.arguments.end.latex"
								}
							},
							"contentName": "meta.data.environment.$4.latex",
							"end": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})",
							"name": "meta.function.environment.$4.latex",
							"patterns": [
								{
									"match": "(?<!\\\\)&",
									"name": "keyword.control.table.cell.latex"
								},
								{
									"include": "#math-formulas"
								},
								{
									"include": "#main-blocks"
								}
							]
						},

						{
							"match": "(\\\\)left\\\\\\{",
							"captures": {
								"1": {
									"name": "punctuation.definition.constant.math.latex"
								}
							},
							"name": "punctuation.math.pair.begin.bracket.curly.latex"
						},
						{
							"match": "(\\\\)right\\\\\\}",
							"captures": {
								"1": {
									"name": "punctuation.definition.constant.math.latex"
								}
							},
							"name": "punctuation.math.pair.end.bracket.curly.latex"
						},
						{
							"match": "(\\\\)left\\(",
							"captures": {
								"1": {
									"name": "punctuation.definition.constant.math.latex"
								}
							},
							"name": "punctuation.math.pair.begin.bracket.round.latex"
						},
						{
							"match": "(\\\\)right\\)",
							"captures": {
								"1": {
									"name": "punctuation.definition.constant.math.latex"
								}
							},
							"name": "punctuation.math.pair.end.bracket.round.latex"
						},
						{
							"match": "(\\\\)left\\[",
							"captures": {
								"1": {
									"name": "punctuation.definition.constant.math.latex"
								}
							},
							"name": "punctuation.math.pair.begin.bracket.square.latex"
						},
						{
							"match": "(\\\\)right\\]",
							"captures": {
								"1": {
									"name": "punctuation.definition.constant.math.latex"
								}
							},
							"name": "punctuation.math.pair.end.bracket.square.latex"
						},
						
						{
							"match": "(?<!\\\\left|\\\\)\\\\\\{",
							"name": "punctuation.math.begin.bracket.curly.latex"
						},
						{
							"match": "(?<!\\\\right|\\\\)\\\\\\}",
							"name": "punctuation.math.end.bracket.curly.latex"
						},
						{
							"match": "(?<!\\\\left|\\\\)\\(",
							"name": "punctuation.math.begin.bracket.round.latex"
						},
						{
							"match": "(?<!\\\\right|\\\\)\\)",
							"name": "punctuation.math.end.bracket.round.latex"
						},
						{
							"match": "(?<!\\\\left|\\\\)\\[",
							"name": "punctuation.math.begin.bracket.square.latex"
						},
						{
							"match": "(?<!\\\\right|\\\\)\\]",
							"name": "punctuation.math.end.bracket.square.latex"
						},

						{
							"include": "#math"
						}
					],
					"repository": {
						"math": {
							"Source": "latex - workshop",
							"patterns": [
								{
									"captures": {
										"1": {
											"name": "punctuation.definition.constant.math.latex"
										}
									},
									"match": "(\\\\)(s(s(earrow|warrow|lash)|h(ort(downarrow|uparrow|parallel|leftarrow|rightarrow|mid)|arp)|tar|i(gma|m(eq)?)|u(cc(sim|n(sim|approx)|curlyeq|eq|approx)?|pset(neq(q)?|plus(eq)?|eq(q)?)?|rd|m|bset(neq(q)?|plus(eq)?|eq(q)?)?)|p(hericalangle|adesuit)|e(tminus|arrow)|q(su(pset(eq)?|bset(eq)?)|c(up|ap)|uare)|warrow|m(ile|all(s(etminus|mile)|frown)))|h(slash|ook(leftarrow|rightarrow)|eartsuit|bar)|R(sh|ightarrow|e|bag)|Gam(e|ma)|n(s(hort(parallel|mid)|im|u(cc(eq)?|pseteq(q)?|bseteq))|Rightarrow|n(earrow|warrow)|cong|triangle(left(eq(slant)?)?|right(eq(slant)?)?)|i(plus)?|u|p(lus|arallel|rec(eq)?)|e(q|arrow|g|xists)|v(dash|Dash)|warrow|le(ss|q(slant|q)?|ft(arrow|rightarrow))|a(tural|bla)|VDash|rightarrow|g(tr|eq(slant|q)?)|mid|Left(arrow|rightarrow))|c(hi|irc(eq|le(d(circ|S|dash|ast)|arrow(left|right)))?|o(ng|prod|lon|mplement)|dot(s|p)?|u(p|r(vearrow(left|right)|ly(eq(succ|prec)|vee(downarrow|uparrow)?|wedge(downarrow|uparrow)?)))|enterdot|lubsuit|ap)|Xi|Maps(to(char)?|from(char)?)|B(ox|umpeq|bbk)|t(h(ick(sim|approx)|e(ta|refore))|imes|op|wohead(leftarrow|rightarrow)|a(u|lloblong)|riangle(down|q|left(eq(slant)?)?|right(eq(slant)?)?)?)|i(n(t(er(cal|leave))?|plus|fty)?|ota|math)|S(igma|u(pset|bset))|zeta|o(slash|times|int|dot|plus|vee|wedge|lessthan|greaterthan|m(inus|ega)|b(slash|long|ar))|d(i(v(ideontimes)?|a(g(down|up)|mond(suit)?)|gamma)|o(t(plus|eq(dot)?)|ublebarwedge|wn(harpoon(left|right)|downarrows|arrow))|d(ots|agger)|elta|a(sh(v|leftarrow|rightarrow)|leth|gger))|Y(down|up|left|right)|C(up|ap)|u(n(lhd|rhd)|p(silon|harpoon(left|right)|downarrow|uparrows|lus|arrow)|lcorner|rcorner)|jmath|Theta|Im|p(si|hi|i(tchfork)?|erp|ar(tial|allel)|r(ime|o(d|pto)|ec(sim|n(sim|approx)|curlyeq|eq|approx)?)|m)|e(t(h|a)|psilon|q(slant(less|gtr)|circ|uiv)|ll|xists|mptyset)|Omega|D(iamond|ownarrow|elta)|v(d(ots|ash)|ee(bar)?|Dash|ar(s(igma|u(psetneq(q)?|bsetneq(q)?))|nothing|curly(vee|wedge)|t(heta|imes|riangle(left|right)?)|o(slash|circle|times|dot|plus|vee|wedge|lessthan|ast|greaterthan|minus|b(slash|ar))|p(hi|i|ropto)|epsilon|kappa|rho|bigcirc))|kappa|Up(silon|downarrow|arrow)|Join|f(orall|lat|a(t(s(emi|lash)|bslash)|llingdotseq)|rown)|P(si|hi|i)|w(p|edge|r)|l(hd|n(sim|eq(q)?|approx)|ceil|times|ightning|o(ng(left(arrow|rightarrow)|rightarrow|maps(to|from))|zenge|oparrow(left|right))|dot(s|p)|e(ss(sim|dot|eq(qgtr|gtr)|approx|gtr)|q(slant|q)?|ft(slice|harpoon(down|up)|threetimes|leftarrows|arrow(t(ail|riangle))?|right(squigarrow|harpoons|arrow(s|triangle|eq)?))|adsto)|vertneqq|floor|l(c(orner|eil)|floor|l|bracket)?|a(ngle|mbda)|rcorner|bag)|a(s(ymp|t)|ngle|pprox(eq)?|l(pha|eph)|rrownot|malg)|V(dash|vdash)|r(h(o|d)|ceil|times|i(singdotseq|ght(s(quigarrow|lice)|harpoon(down|up)|threetimes|left(harpoons|arrows)|arrow(t(ail|riangle))?|rightarrows))|floor|angle|r(ceil|parenthesis|floor|bracket)|bag)|g(n(sim|eq(q)?|approx)|tr(sim|dot|eq(qless|less)|less|approx)|imel|eq(slant|q)?|vertneqq|amma|g(g)?)|Finv|xi|m(ho|i(nuso|d)|o(o|dels)|u(ltimap)?|p|e(asuredangle|rge)|aps(to|from(char)?))|b(i(n(dnasrepma|ampersand)|g(s(tar|qc(up|ap))|nplus|c(irc|u(p|rly(vee|wedge))|ap)|triangle(down|up)|interleave|o(times|dot|plus)|uplus|parallel|vee|wedge|box))|o(t|wtie|x(slash|circle|times|dot|plus|empty|ast|minus|b(slash|ox|ar)))|u(llet|mpeq)|e(cause|t(h|ween|a))|lack(square|triangle(down|left|right)?|lozenge)|a(ck(s(im(eq)?|lash)|prime|epsilon)|r(o|wedge))|bslash)|L(sh|ong(left(arrow|rightarrow)|rightarrow|maps(to|from))|eft(arrow|rightarrow)|leftarrow|ambda|bag)|Arrownot)(?=\\b|_)",
									"name": "constant.character.math.tex"
								},
								{
									"captures": {
										"1": {
											"name": "punctuation.definition.constant.math.latex"
										}
									},
									"match": "(\\\\)(sum|prod|coprod|int|oint|bigcap|bigcup|bigsqcup|bigvee|bigwedge|bigodot|bigotimes|bogoplus|biguplus)\\b",
									"name": "constant.character.math.tex"
								},
								{
									"captures": {
										"1": {
											"name": "punctuation.definition.constant.math.latex"
										}
									},
									"match": "(\\\\)(arccos|arcsin|arctan|arg|cos|cosh|cot|coth|csc|deg|det|dim|exp|gcd|hom|inf|ker|lg|lim|liminf|limsup|ln|log|max|min|pr|sec|sin|sinh|sup|tan|tanh)\\b",
									"name": "constant.other.math.tex"
								},
		
								{
								  "begin": "((\\\\)Sexpr(\\{))",
								  "beginCaptures": {
									"1": {
									  "name": "support.function.sexpr.math.tex"
									},
									"2": {
									  "name": "punctuation.definition.function.math.tex"
									},
									"3": {
									  "name": "punctuation.section.embedded.begin.math.tex"
									}
								  },
								  "contentName": "support.function.sexpr.math.tex",
								  "end": "(((\\})))",
								  "endCaptures": {
									"1": {
									  "name": "support.function.sexpr.math.tex"
									},
									"2": {
									  "name": "punctuation.section.embedded.end.math.tex"
									},
									"3": {
									  "name": "source.r"
									}
								  },
								  "name": "meta.embedded.line.r",
								  "patterns": [
									{
									  "begin": "\\G(?!\\})",
									  "end": "(?=\\})",
									  "name": "source.r",
									  "patterns": [
										{
										  "include": "source.r"
										}
									  ]
									}
								  ]
								},
		
								{
									"captures": {
										"1": {
											"name": "punctuation.definition.constant.math.latex"
										}
									},
									"match": "(\\\\)(?!begin\\{|verb)([A-Za-z]+)",
									"name": "constant.other.general.math.tex"
								},
								{
									"match": "(([0-9]*[\\.][0-9]+)|[0-9]+)",
									"name": "constant.numeric.math.tex"
								},
								{
									"match": "«press a-z and space for greek letter»[a-zA-Z]*",
									"name": "meta.placeholder.greek.math.tex"
								}
							]
						}
					}
				}
			}
		},

		"main-blocks": {
			"patterns": [
				{
					"include": "#comments"
				},
				{
					"include": "#reference"
				},
				{
					"include": "#layouts"
				},
				{
					"include": "#fonts"
				},
				
				{
					"match": "(?<!\\\\)&",
					"name": "invalid.illegal.equation.align.latex",
					"Cname": "keyword.control.equation.align.latex"
				},

				{
					"begin": "((\\\\)((?:sub){0,2}section|(?:sub)?paragraph|chapter|part|addpart|addchap|addsec|minisec|frametitle)(?:\\*)?)((?:\\[[^\\[]*?\\]){0,2})(\\{)",
					"beginCaptures": {
						"1": {
							"name": "support.function.section.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"4": {
							"patterns": [
								{
									"include": "#optional-arg"
								}
							]
						},
						"5": {
							"name": "punctuation.definition.arguments.begin.latex"
						}
					},
					"comment": "this works OK with all kinds of crazy stuff as long as section is one line",
					"contentName": "entity.name.section.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"name": "meta.function.section.$3.latex",
					"patterns": [
						{
							"include": "#fonts"
						}
					]
				},

				{
					"begin": "(?<!\\\\)\\{",
					"beginCaptures": {
						"0": {
							"name": "punctuation.group.begin.tex"
						}
					},
					"end": "(?<!\\\\)\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.group.end.tex"
						}
					},
					"name": "meta.group.braces.main.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-bloks"
						}
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(tabular[xy*]?|xltabular)(\\})",
					"Cbegin": "(?:\\s*)((\\\\)begin)(\\{)(array|tabular[xy*]?|xltabular|aligned)(\\})(\\s*\\n)?",
					"Comment-begin": "I want to add the parameters here",
					"captures": {
						"1": {
							"name": "support.function.be.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						},
						"4": {
							"name": "variable.parameter.function.latex"
						},
						"5": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"contentName": "meta.data.environment.$4.latex",
					"end": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})",
					"Cend": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.$4.latex",
					"patterns": [
						{
							"match": "(?<!\\\\)&",
							"name": "keyword.control.table.cell.latex"
						},
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-blocks"							
						}
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(array|aligned)(\\})",
					"captures": {
						"1": {
							"name": "support.function.be.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						},
						"4": {
							"name": "variable.parameter.function.latex"
						},
						"5": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"contentName": "meta.data.environment.$4.latex",
					"end": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})",
					"name": "meta.function.environment.$4.latex",
					"patterns": [
						{
							"match": "(?<!\\\\)&",
							"name": "keyword.control.table.cell.latex"
						},
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-blocks"							
						}
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(itemize|enumerate|description|list)(\\})",
					"captures": {
						"1": {
							"name": "support.function.be.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						},
						"4": {
							"name": "variable.parameter.function.latex"
						},
						"5": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"end": "((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.$4.latex",
					"patterns": [
						{
							"captures": {
								"0": {
									"name": "keyword.other.item.latex"
								},
								"1": {
									"name": "punctuation.definition.keyword.latex"
								}
							},
							"match": "(\\\\)item\\b",
							"name": "meta.scope.item.latex"
						},
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-blocks"							
						}
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)((?:gathered|cases)(?:\\*)?)(\\})(\\s*\\n)?",
					"captures": {
						"1": {
							"name": "support.function.be.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.arguments.begin.latex"
						},
						"4": {
							"name": "variable.parameter.function.latex"
						},
						"5": {
							"name": "punctuation.definition.arguments.end.latex"
						}
					},
					"end": "(?:\\s*)((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.$4.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-blocks"							
						}
					]
				},

				{
					"include": "#other-blocks"
				},
				{
					"include": "#other-functions"
				}
			],
			"repository": {
				"layouts": {
					"patterns": [
						{
							"match": "\\\\(?:newline|pagebreak|clearpage|linebreak|pause)(?:\\b)",
							"name": "keyword.control.layout.latex"
						},
						{
							"match": "\\\\\\\\",
							"name": "keyword.control.newline.latex"
						}
					]
				},
				"reference": {
					"patterns": [
						{
							"include": "#definition-label"
						},
						{
							"captures": {
								"1": {
									"name": "support.function.url.latex"
								},
								"2": {
									"name": "punctuation.definition.function.latex"
								},
								"3": {
									"name": "punctuation.definition.arguments.begin.latex"
								},
								"4": {
									"name": "markup.underline.link.latex"
								},
								"5": {
									"name": "punctuation.definition.arguments.end.latex"
								}
							},
							"match": "(?:\\s*)((\\\\)(?:url|href))(\\{)([^}]*)(\\})",
							"name": "meta.function.link.url.latex"
						},
						{
							"begin": "((\\\\)(?:\\w*[r|R]ef\\*?))(\\{)",
							"beginCaptures": {
								"1": {
									"name": "keyword.control.ref.latex"
								},
								"2": {
									"name": "punctuation.definition.keyword.latex"
								},
								"3": {
									"name": "punctuation.definition.arguments.begin.latex"
								}
							},
							"end": "\\}",
							"endCaptures": {
								"0": {
									"name": "punctuation.definition.arguments.end.latex"
								}
							},
							"name": "meta.reference.label.latex",
							"patterns": [
								{
									"match": "[a-zA-Z0-9\\.,:/*!^_-]",
									"Cname": "constant.other.reference.label.latex",
									"name": "variable.parameter.reference.label.latex"
								}
							]
						}
					]
				}
			}
		},

		"other-blocks": {
			"patterns": [
				{
					"begin": "(^\\s*)?(?=\\\\begin\\{(lstlisting|minted|pyglist)\\})",
					"beginCaptures": {
					  "0": {
						"name": "punctuation.whitespace.embedded.leading.latex"
					  }
					},
					"end": "(?!\\G)(\\s*$\\n?)?",
					"endCaptures": {
					  "0": {
						"name": "punctuation.whitespace.embedded.trailing.latex"
					  }
					},
					"patterns": [
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{(?:cpp|c)\\})",
						"captures": {
							"1": {
								"patterns": [
									{
										"include": "#minted-env"
									}
								]
							}
						},
						"contentName": "source.cpp.embedded.latex",
						"patterns": [
							{
								"include": "source.cpp.embedded.latex"
							}
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{css\\})",
						"captures": {
							"1": {
								"patterns": [
									{
										"include": "#minted-env"
									}
								]
							}
						},
						"contentName": "source.css",
						"patterns": [
							{
								"include": "source.css"
							}
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{html\\})",
						"captures": {
							"1": {
								"patterns": [
									{
										"include": "#minted-env"
									}
								]
							}
						},
						"contentName": "text.html",
						"patterns": [
						  {
							"include": "text.html"
						  }
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{java\\})",
						"captures": {
							"1": {
								"patterns": [
									{
										"include": "#minted-env"
									}
								]
							}
						},
						"contentName": "source.java",
						"patterns": [
							{
								"include": "source.java"
							}
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{(?:js|javascript)\\})",
						"captures": {
						  "1": {
							"patterns": [
							  {
								"include": "#minted-env"
							  }
							]
						  }
						},
						"contentName": "source.js",
						"patterns": [
						  {
							"include": "source.js"
						  }
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{lua\\})",
						"captures": {
						  "1": {
							"patterns": [
							  {
								"include": "#minted-env"
							  }
							]
						  }
						},
						"contentName": "source.lua",
						"patterns": [
						  {
							"include": "source.lua"
						  }
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{(?:python|py)\\})",
						"captures": {
						  "1": {
							"patterns": [
							  {
								"include": "#minted-env"
							  }
							]
						  }
						},
						"contentName": "source.python",
						"patterns": [
						  {
							"include": "source.python"
						  }
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{xml\\})",
						"captures": {
						  "1": {
							"patterns": [
							  {
								"include": "#minted-env"
							  }
							]
						  }
						},
						"contentName": "yaml.xml",
						"patterns": [
						  {
							"include": "yaml.xml"
						  }
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{minted\\}(?:\\[.*\\])?\\{yaml\\})",
						"captures": {
						  "1": {
							"patterns": [
							  {
								"include": "#minted-env"
							  }
							]
						  }
						},
						"contentName": "source.yaml",
						"patterns": [
						  {
							"include": "source.yaml"
						  }
						],
						"end": "(\\\\end\\{minted\\})"
					  },
					  {
						"begin": "(\\\\begin\\{(?:lstlisting|minted|pyglist)\\}(?:\\[.*\\])?)",
						"captures": {
						  "1": {
							"patterns": [
							  {
								"include": "#minted-env"
							  }
							]
						  }
						},
						"contentName": "meta.function.embedded.latex",
						"end": "(\\\\end\\{(?:lstlisting|minted|pyglist)\\})",
						"name": "meta.embedded.block.generic"
					  }
					]
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{(cppcode(?:\\*)?)\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
						  {
							"include": "#code-env"
						  }
						]
					  }
					},
					"contentName": "source.cpp.embedded.latex",
					"patterns": [
					  {
						"include": "source.cpp.embedded.latex"
					  },
					  {
						"include": "source.cpp"
					  }
					],
					"end": "(\\\\end\\{\\2\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{(hscode(?:\\*)?)\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
						  {
							"include": "#code-env"
						  }
						]
					  }
					},
					"contentName": "source.haskell",
					"patterns": [
					  {
						"include": "source.haskell"
					  }
					],
					"end": "(\\\\end\\{\\2\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{(luacode(?:\\*)?)\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
						  {
							"include": "#code-env"
						  }
						]
					  }
					},
					"contentName": "source.lua",
					"patterns": [
					  {
						"include": "source.lua"
					  }
					],
					"end": "(\\\\end\\{\\2\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{((?:pycode|sageblock|sagesilent|sageverbatim|sageexample|sagecommandline)(?:\\*)?)\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
						  {
							"include": "#code-env"
						  }
						]
					  }
					},
					"contentName": "source.python",
					"patterns": [
					  {
						"include": "source.python"
					  }
					],
					"end": "(\\\\end\\{\\2\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{(scalacode(?:\\*)?)\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
						  {
							"include": "#code-env"
						  }
						]
					  }
					},
					"contentName": "source.scala",
					"patterns": [
					  {
						"include": "source.scala"
					  }
					],
					"end": "(\\\\end\\{\\2\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{([a-z]*code(?:\\*)?)\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
						  {
							"include": "#code-env"
						  }
						]
					  }
					},
					"end": "(\\\\end\\{\\2\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{asy\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
						  {
							"include": "#code-env"
						  }
						]
					  }
					},
					"contentName": "source.asymptote",
					"patterns": [
						{
							"include": "source.asymptote"
						}
					],
					"end": "(\\\\end\\{asy\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{dot2tex\\}(?:\\[.*\\])?)",
					"captures": {
					  "1": {
						"patterns": [
							{
								"include": "#code-env"
							}
						]
					  }
					},
					"contentName": "source.dot",
					"patterns": [
						{
							"include": "source.dot"
						}
					],
					"end": "(\\\\end\\{dot2tex\\}(?:\\s*\\n)?)"
				},
				{
					"begin": "((?:\\s*)\\\\begin\\{gnuplot\\}(?:\\[.*\\])?)",
					"captures": {
						"1": {
							"patterns": [
								{
									"include": "#code-env"
								}
							]
						}
					},
					"contentName": "source.gnuplot",
					"patterns": [
						{
							"include": "source.gnuplot"
						}
					],
					"end": "(\\\\end\\{gnuplot\\}(?:\\s*\\n)?)"
				},

				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)((?:fboxv|boxedv|V|v)erbatim)(\\})",
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"contentName": "markup.raw.verbatim.latex",
					"end": "((\\\\)end)(\\{)(\\4)(\\})",
					"name": "meta.function.verbatim.latex"
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(VerbatimOut)(\\})(\\{)([^\\}]*)(\\})",
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  },
					  "6": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "7": {
						"name": "support.class.latex"
					  },
					  "8": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"contentName": "markup.raw.verbatim.latex",
					"end": "((\\\\)end)(\\{)(\\VerbatimOut)(\\})",
					"name": "meta.function.verbatim.latex"
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(alltt)(\\})",
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"contentName": "markup.raw.verbatim.latex",
					"end": "((\\\\)end)(\\{)(alltt)(\\})",
					"name": "meta.function.alltt.latex",
					"patterns": [
					  {
						"captures": {
						  "1": {
							"name": "punctuation.definition.function.latex"
						  }
						},
						"match": "(\\\\)[A-Za-z]+",
						"name": "support.function.general.latex"
					  }
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)((?:C|c)omment)(\\})",
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"contentName": "punctuation.definition.comment.latex",
					"end": "((\\\\)end)(\\{)(\\4)(\\})",
					"name": "meta.function.verbatim.latex"
				},

				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(tikzpicture)(\\})",
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"end": "((\\\\)end)(\\{)(tikzpicture)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.latex.tikz",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-blocks"						
						}
					]
				},
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(frame)(\\})",
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"end": "((\\\\)end)(\\{)(frame)(\\})",
					"name": "meta.function.environment.frame.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-blocks"						
						}
					]
				},
			  
				{
					"begin": "(?:\\s*)((\\\\)begin)(\\{)(mpost[*]?)(\\})",
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"end": "((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
					"name": "meta.function.environment.latex.mpost"
				},

				{
					"include": "#rest-blocks"
				}
			],
			"repository": {
				"minted-env": {
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  },
					  "6": {
						"name": "punctuation.definition.arguments.optional.begin.latex"
					  },
					  "7": {
						"name": "punctuation.definition.arguments.optional.end.latex"
					  },
					  "8": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "9": {
						"name": "variable.parameter.function.latex"
					  },
					  "10": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"match": "((\\\\)(?:begin|end))(\\{)(lstlisting|minted|pyglist)(\\})(?:(\\[).*(\\]))?(?:(\\{)([a-z]*)(\\}))?",
					"patterns": []
				},
			  
				"code-env": {
					"captures": {
					  "1": {
						"name": "support.function.be.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"name": "punctuation.definition.arguments.begin.latex"
					  },
					  "4": {
						"name": "variable.parameter.function.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.end.latex"
					  },
					  "6": {
						"name": "punctuation.definition.arguments.optional.begin.latex"
					  },
					  "7": {
						"name": "punctuation.definition.arguments.optional.end.latex"
					  }
					},
					"match": "(?:\\s*)((\\\\)(?:begin|end))(\\{)([a-z]*code(?:\\*)?|gnuplot|dot2tex|asy|sage[a-z]*)(\\})(?:(\\[).*(\\]))?",
					"patterns": []
				}
			}
		},
		"other-functions": {
			"patterns": [
				{
					"include": "#verb"
				},
				{
					"captures": {
					  "1": {
						"name": "punctuation.definition.constant.latex"
					  }
					},
					"match": "(\\\\)(text(s(terling|ixoldstyle|urd|e(ction|venoldstyle|rvicemark))|yen|n(ineoldstyle|umero|aira)|c(ircledP|o(py(left|right)|lonmonetary)|urrency|e(nt(oldstyle)?|lsius))|t(hree(superior|oldstyle|quarters(emdash)?)|i(ldelow|mes)|w(o(superior|oldstyle)|elveudash)|rademark)|interrobang(down)?|zerooldstyle|o(hm|ne(superior|half|oldstyle|quarter)|penbullet|rd(feminine|masculine))|d(i(scount|ed|v(orced)?)|o(ng|wnarrow|llar(oldstyle)?)|egree|agger(dbl)?|blhyphen(char)?)|uparrow|p(ilcrow|e(so|r(t(housand|enthousand)|iodcentered))|aragraph|m)|e(stimated|ightoldstyle|uro)|quotes(traight(dblbase|base)|ingle)|f(iveoldstyle|ouroldstyle|lorin|ractionsolidus)|won|l(not|ira|e(ftarrow|af)|quill|angle|brackdbl)|a(s(cii(caron|dieresis|acute|grave|macron|breve)|teriskcentered)|cutedbl)|r(ightarrow|e(cipe|ferencemark|gistered)|quill|angle|brackdbl)|g(uarani|ravedbl)|m(ho|inus|u(sicalnote)?|arried)|b(igcircle|orn|ullet|lank|a(ht|rdbl)|rokenbar)))\\b",
					"name": "constant.character.latex"
				},
				{
					"captures": {
					  "1": {
						"name": "punctuation.definition.column-specials.begin.latex"
					  },
					  "2": {
						"name": "punctuation.definition.column-specials.end.latex"
					  }
					},
					"match": "(?:<|>)(\\{)\\$(\\})",
					"name": "meta.column-specials.latex"
				},
				{
					"begin": "((\\\\)(?:auto|foot|full|no|short|text|paren)?[cC]ite(?:al)?(?:p|s|t|author|year(?:par)?|title)?[ANP]*\\*?)((?:(?:\\[[^\\]]*\\]){0,2}\\{[\\w:.]+\\})*)(?:(\\[)[^\\]]*(\\]))?(?:(\\[)[^\\]]*(\\]))?(\\{)",
					"captures": {
					  "1": {
						"name": "keyword.control.cite.latex"
					  },
					  "2": {
						"name": "punctuation.definition.keyword.latex"
					  },
					  "3": {
						"patterns": [
						  {
							"include": "#autocites-arg"
						  }
						]
					  },
					  "4": {
						"name": "punctuation.definition.arguments.optional.begin.latex"
					  },
					  "5": {
						"name": "punctuation.definition.arguments.optional.end.latex"
					  },
					  "6": {
						"name": "punctuation.definition.arguments.optional.begin.latex"
					  },
					  "7": {
						"name": "punctuation.definition.arguments.optional.end.latex"
					  },
					  "8": {
						"name": "punctuation.definition.arguments.begin.latex"
					  }
					},
					"end": "\\}",
					"endCaptures": {
					  "0": {
						"name": "punctuation.definition.arguments.end.latex"
					  }
					},
					"name": "meta.citation.latex",
					"patterns": [
					  {
						"match": "[\\w:.]+",
						"name": "constant.other.reference.citation.latex"
					  }
					]
				},
				{
					"begin": "((\\\\)marginpar)((?:\\[[^\\[]*?\\])*)(\\{)",
					"beginCaptures": {
					  "1": {
						"name": "support.function.marginpar.latex"
					  },
					  "2": {
						"name": "punctuation.definition.function.latex"
					  },
					  "3": {
						"patterns": [
						  {
							"include": "#optional-arg"
						  }
						]
					  },
					  "4": {
						"name": "punctuation.definition.marginpar.begin.latex"
					  }
					},
					"contentName": "meta.paragraph.margin.latex",
					"end": "\\}",
					"endCaptures": {
					  "0": {
						"name": "punctuation.definition.marginpar.end.latex"
					  }
					},
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#main-blocks"						
						}
					]
				},

				{
					"include": "#rest-functions"
				}
			],
			"repository": {
				"verb": {
					"patterns": [
						{
							"begin": "((\\\\)verb[\\*]?)\\s*((\\\\)scantokens)(\\{)",
							"beginCaptures": {
							  "1": {
								"name": "support.function.verb.latex"
							  },
							  "2": {
								"name": "punctuation.definition.function.latex"
							  },
							  "3": {
								"name": "support.function.verb.latex"
							  },
							  "4": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "5": {
								"name": "punctuation.definition.begin.latex"
							  }
							},
							"contentName": "markup.raw.verb.latex",
							"end": "(\\})",
							"endCaptures": {
							  "1": {
								"name": "punctuation.definition.end.latex"
							  }
							},
							"name": "meta.function.verb.latex",
							"patterns": [
							  {
								"include": "$self"
							  }
							]
						},
						{
							"captures": {
							  "1": {
								"name": "support.function.verb.latex"
							  },
							  "2": {
								"name": "punctuation.definition.function.latex"
							  },
							  "3": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "4": {
								"name": "markup.raw.verb.latex"
							  },
							  "5": {
								"name": "punctuation.definition.verb.latex"
							  }
							},
							"match": "((\\\\)verb[\\*]?)\\s*((?<=\\s)\\S|[^a-zA-Z])(.*?)(\\3|$)",
							"name": "meta.function.verb.latex"
						},
						{
							"captures": {
							  "1": {
								"name": "support.function.verb.latex"
							  },
							  "2": {
								"name": "punctuation.definition.function.latex"
							  },
							  "3": {
								"patterns": [
								  {
									"include": "#optional-arg"
								  }
								]
							  },
							  "4": {
								"name": "punctuation.definition.arguments.begin.latex"
							  },
							  "5": {
								"name": "punctuation.definition.arguments.end.latex"
							  },
							  "6": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "7": {
								"name": "markup.raw.verb.latex"
							  },
							  "8": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "9": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "10": {
								"name": "markup.raw.verb.latex"
							  },
							  "11": {
								"name": "punctuation.definition.verb.latex"
							  }
							},
							"match": "((\\\\)(?:mint|mintinline))((?:\\[[^\\[]*?\\])?)(\\{)[a-zA-Z]*(\\})(?:(?:([^a-zA-Z\\{])(.*?)(\\6))|(?:(\\{)(.*?)(\\})))",
							"name": "meta.function.verb.latex"
						},
						{
							"captures": {
							  "1": {
								"name": "support.function.verb.latex"
							  },
							  "2": {
								"name": "punctuation.definition.function.latex"
							  },
							  "3": {
								"patterns": [
								  {
									"include": "#optional-arg"
								  }
								]
							  },
							  "4": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "5": {
								"name": "markup.raw.verb.latex"
							  },
							  "6": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "7": {
								"name": "punctuation.definition.verb.latex"
							  },
							  "8": {
								"name": "markup.raw.verb.latex"
							  },
							  "9": {
								"name": "punctuation.definition.verb.latex"
							  }
							},
							"match": "((\\\\)[a-z]+inline)((?:\\[[^\\[]*?\\])?)(?:(?:([^a-zA-Z\\{])(.*?)(\\4))|(?:(\\{)(.*?)(\\})))",
							"name": "meta.function.verb.latex"
						}
					]
				},

				"autocites-arg": {
					"patterns": [
					  {
						"captures": {
						  "1": {
							"name": "punctuation.definition.arguments.optional.begin.latex"
						  },
						  "2": {
							"name": "punctuation.definition.arguments.optional.end.latex"
						  },
						  "3": {
							"name": "punctuation.definition.arguments.optional.begin.latex"
						  },
						  "4": {
							"name": "punctuation.definition.arguments.optional.end.latex"
						  },
						  "5": {
							"name": "punctuation.definition.arguments.begin.latex"
						  },
						  "6": {
							"name": "constant.other.reference.citation.latex"
						  },
						  "7": {
							"name": "punctuation.definition.arguments.end.latex"
						  },
						  "8": {
							"patterns": [
							  {
								"include": "#autocites-arg"
							  }
							]
						  }
						},
						"match": "(?:(\\[)[^\\]]*(\\]))?(?:(\\[)[^\\]]*(\\]))?(\\{)([\\w:.]+)(\\})(.*)"
					  }
					]
				}
			}
		},

		"rest-blocks": {
			"begin": "(?:\\s*)((\\\\)begin)(\\{)(\\w+[*]?)(\\})",
			"captures": {
				"1": {
					"name": "support.function.be.latex"
				},
				"2": {
					"name": "punctuation.definition.function.latex"
				},
				"3": {
					"name": "punctuation.definition.arguments.begin.latex"
				},
				"4": {
					"name": "variable.parameter.function.latex"
				},
				"5": {
					"name": "punctuation.definition.arguments.end.latex"
				}
			},
			"end": "((\\\\)end)(\\{)(\\4)(\\})(?:\\s*\\n)?",
			"name": "meta.function.environment.general.$4.latex",
			"patterns": [
				{
					"include": "#math-blocks"
				},
				{
					"include": "#main-blocks"						
				}
			]
		},
		"rest-functions": {
			"captures": {
				"1": {
					"name": "punctuation.definition.function.latex"
				}
			},
			"match": "(\\\\)[A-Za-z]+",
			"name": "support.function.general.latex",
			"patterns": []
		},

		"fonts": {
			"patterns": [
				{
					"begin": "((\\\\)footnote)((?:\\[[^\\[]*?\\])*)(\\{)",
					"beginCaptures": {
						"1": {
							"name": "support.function.footnote.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"patterns": [
								{
									"include": "#optional-arg"
								}
							]
						},
						"4": {
							"name": "punctuation.definition.footnote.begin.latex"
						}
					},
					"contentName": "entity.name.footnote.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.footnote.end.latex"
						}
					},
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#fonts"
						},
						{
							"include": "#font-braces"
						}
					]
				},
				{
					"begin": "((\\\\)emph)(\\{)",
					"beginCaptures": {
						"1": {
							"name": "support.function.emph.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.emph.begin.latex"
						}
					},
					"contentName": "markup.italic.emph.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.emph.end.latex"
						}
					},
					"name": "meta.function.emph.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#fonts"
						},
						{
							"include": "#font-braces"
						}
					]
				},
				{
					"begin": "((\\\\)textit)(\\{)",
					"captures": {
						"1": {
							"name": "support.function.textit.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.textit.begin.latex"
						}
					},
					"comment": "We put the keyword in a capture and name this capture, so that disabling spell checking for “keyword” won't be inherited by the argument to \\textit{...}.\n\nPut specific matches for particular LaTeX keyword.functions before the last two more general functions",
					"contentName": "markup.italic.textit.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.textit.end.latex"
						}
					},
					"name": "meta.function.textit.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#fonts"
						},
						{
							"include": "#font-braces"
						}
					]
				},
				{
					"begin": "((\\\\)textbf)(\\{)",
					"captures": {
						"1": {
							"name": "support.function.textbf.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.textbf.begin.latex"
						}
					},
					"contentName": "markup.bold.textbf.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.textbf.end.latex"
						}
					},
					"name": "meta.function.textbf.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#fonts"
						},
						{
							"include": "#font-braces"
						}
					]
				},
				{
					"begin": "((\\\\)texttt)(\\{)",
					"captures": {
						"1": {
							"name": "support.function.texttt.latex"
						},
						"2": {
							"name": "punctuation.definition.function.latex"
						},
						"3": {
							"name": "punctuation.definition.texttt.begin.latex"
						}
					},
					"contentName": "markup.raw.texttt.latex",
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.texttt.end.latex"
						}
					},
					"name": "meta.function.texttt.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#fonts"
						},
						{
							"include": "#font-braces"
						}
					]
				}
			],
			"repository": {
				"font-braces": {
					"begin": "(?<!\\\\)\\{",
					"beginCaptures": {
						"0": {
							"name": "punctuation.group.begin.tex"
						}
					},
					"end": "(?<!\\\\)\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.group.end.tex"
						}
					},
					"name": "meta.group.braces.font.latex",
					"patterns": [
						{
							"include": "#math-blocks"
						},
						{
							"include": "#fonts"
						}
					]
				}
			}
		},
		"definition-label": {
			"begin": "((\\\\)label)(\\{)",
			"beginCaptures": {
				"1": {
					"name": "keyword.control.label.latex"
				},
				"2": {
					"name": "punctuation.definition.keyword.latex"
				},
				"3": {
					"name": "punctuation.definition.arguments.begin.latex"
				}
			},
			"end": "\\}",
			"endCaptures": {
				"0": {
					"name": "punctuation.definition.arguments.end.latex"
				}
			},
			"name": "meta.definition.label.latex",
			"patterns": [
				{
					"match": "[a-zA-Z0-9\\.,:/*!^_-]",
					"name": "variable.parameter.definition.label.latex"
				}
			]
		},
		"optional-arg": {
			"patterns": [
				{
					"captures": {
						"1": {
							"name": "punctuation.definition.optional.arguments.begin.latex"
						},
						"2": {
							"name": "variable.parameter.latex"
						},
						"3": {
							"name": "punctuation.definition.optional.arguments.end.latex"
						}
					},
					"match": "(\\[)([^\\[]*?)(\\])"
				}
			]
		},

		"comments": {
			"Source": "texshop",
			"Comment": "???",
			"patterns": [
				{
					"begin": "(^[ \\t]+)?(?=%)",
					"beginCaptures": {
					  "1": {
						"name": "punctuation.whitespace.comment.leading.latex"
					  }
					},
					"end": "(?!\\G)",
					"patterns": [
						{
							"begin": "%:",
							"beginCaptures": {
								"0": {
									"name": "punctuation.definition.comment.tex"
								}
							},
							"end": "$\\n?",
							"name": "comment.line.percentage.semicolon.texshop.tex"
						},
						{
							"begin": "^(%!TEX) (\\S*) =",
							"beginCaptures": {
								"1": {
									"name": "punctuation.definition.comment.tex"
								}
							},
							"end": "$\\n?",
							"name": "comment.line.percentage.directive.texshop.tex"
						},
						{
							"begin": "%",
							"beginCaptures": {
								"0": {
									"name": "punctuation.definition.comment.tex"
								}
							},
							"end": "$\\n?",
							"name": "comment.line.percentage.tex"
						}
					]
				}
			]
		}
	}
}